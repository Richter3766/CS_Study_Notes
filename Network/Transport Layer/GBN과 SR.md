# GBN와 SR

Go-Back-N (GBN)과 Selective Repeat (SR)은 네트워크 환경에서 손실이나 오류 없이 데이터를 안정적으로 전송하기 위해 사용되는 대표적인 윈도우 기반 프로토콜입니다.  
이들은 슬라이딩 윈도우 방식을 활용하여 여러 개의 패킷을 연속적으로 전송하고, 오류 발생 시 재전송 메커니즘을 통해 데이터의 신뢰성을 보장합니다.

## Go-Back-N (GBN)

### 송신자 (Sender)

- **윈도우:**  
  N 사이즈의 윈도우를 사용하여 전송할 패킷 범위를 관리합니다.
- **상태 관리:**  
  윈도우 내의 각 패킷은 다음과 같은 상태를 가질 수 있습니다.
  - `Already ACKed`:  
    이미 ACK를 받은 패킷.
  - `Sent Not Yet ACKed`:  
    전송되었지만 아직 ACK를 받지 못한 패킷.
  - `Usable Not Yet Sent`:  
    윈도우 내에서 전송 가능하지만 아직 전송되지 않은 패킷
  - `Not Usable`:  
    윈도우 밖에 있어 아직 전송할 수 없는 패킷.
- **Cumulative ACK (누적 응답):**
  - 수신자로부터 ACK를 받으면, 해당 ACK 번호까지의 모든 패킷이 정상적으로 수신되었다고 간주합니다.
  - 예를 들어, ACK 번호 'n'을 받으면, 1번부터 n번까지의 패킷이 모두 정상적으로 수신된 것으로 처리합니다.
  - (n+1)번 패킷을 전송합니다.
- **타임아웃:**
  - 각 패킷에 대해 타임아웃을 설정합니다.
  - 설정된 시간 내에 ACK를 받지 못하면 해당 패킷과 그 이후의 모든 패킷을 재전송합니다.

### 수신자 (Receiver)

- **ACK Only:**  
  데이터 패킷에 대한 ACK만 전송합니다.
- **`rcv_base` (수신 기준):**  
  현재 예상되는 다음 패킷의 시퀀스 번호(`rcv_base`)를 유지합니다.
- **순서 기반 수신:**  
  `rcv_base`와 일치하는 패킷만 수신하고 ACK를 전송합니다.
- **Out-of-Order 패킷 처리:**  
  `rcv_base`와 다른 시퀀스 번호를 가진 패킷은 모두 폐기합니다. 버퍼링하지 않습니다.

**GBN의 특징 및 고려 사항:**

- **단순함:** 구현이 비교적 간단합니다.
- **비효율성:** 오류 발생 시 해당 패킷 이후의 모든 패킷을 재전송하므로 네트워크 자원 낭비가 심할 수 있습니다. 특히 오류율이 높은 환경에서는 성능이 크게 저하됩니다.
- **흐름 제어:** 수신측의 버퍼링 능력이 중요하지 않습니다. 수신자는 순서대로 도착하는 패킷만 처리하므로, 송신자는 수신자의 처리 능력을 고려할 필요 없이 윈도우 크기 내에서 전송할 수 있습니다.

## Selective Repeat (SR)

### 송신자 (Sender)

- **개별 ACK 관리:**  
  각 패킷에 대해 개별적인 ACK를 기반으로 동작합니다.
- **타임아웃 및 재전송:**  
  ACK를 받지 못한 패킷에 대해서만 타임아웃을 설정하고 재전송합니다.
- **윈도우:**  
  N 사이즈의 윈도우를 사용하여 전송할 패킷 범위를 관리합니다.

### 수신자 (Receiver)

- **개별 ACK:**  
  각 패킷에 대해 개별 ACK를 전송합니다.
- **Out-of-Order 버퍼링:**  
  순서에 맞지 않는 패킷을 버리지 않고 버퍼에 저장합니다.
- **재정렬:**  
  필요한 경우 버퍼에 저장된 패킷들을 순서에 맞게 재정렬하여 상위 계층에 전달합니다.

**SR의 특징 및 고려 사항:**

- **효율성:** 필요한 패킷만 재전송하므로 Go-Back-N에 비해 효율적입니다.
- **복잡성:** 송신자와 수신자 모두 더 복잡한 로직을 필요로 합니다. 특히 수신측의 버퍼 관리 및 재정렬 로직이 복잡해집니다.
- **윈도우 크기 및 시퀀스 번호:**
  - **중요한 문제:**  
    윈도우 크기(N)를 잘못 설정하면 심각한 문제가 발생할 수 있습니다.  
    특히 윈도우 크기가 최대 시퀀스 번호 범위에 비해 너무 클 경우, 오래된 패킷이 재전송되어 새로운 패킷으로 오인될 수 있습니다.
  - **해결 방법:**  
    윈도우 크기는 최대 시퀀스 번호의 절반 이하로 설정해야 합니다.  
    예를 들어, 시퀀스 번호가 k 비트인 경우, 시퀀스 번호의 범위는 2^k 이고, 윈도우 크기 N은 N <= 2^(k-1)을 만족해야 합니다.

**요약:**

| 특징          | Go-Back-N                            | Selective Repeat                                 |
| ------------- | ------------------------------------ | ------------------------------------------------ |
| 재전송 방식   | 오류 발생 패킷 이후 모든 패킷 재전송 | 오류 발생 패킷만 재전송                          |
| 효율성        | 낮음                                 | 높음                                             |
| 복잡성        | 비교적 단순                          | 복잡함                                           |
| 버퍼링        | 수신측 버퍼링 불필요                 | 수신측 버퍼링 필요                               |
| 윈도우/시퀀스 | 윈도우 크기에 대한 제약 비교적 적음  | 윈도우 크기 및 시퀀스 번호 관리에 특히 주의 필요 |
| 구현 난이도   | 쉬움                                 | 어려움                                           |
